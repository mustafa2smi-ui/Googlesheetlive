<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìÖ Date-wise Google Sheet Data</title>
<style>
body { font-family: "Segoe UI", sans-serif; background: #f4f6f8; margin:0; padding:20px; }
h1 { text-align:center; color:#333; }
.group { background:white; border-radius:12px; margin:15px auto; padding:10px 15px; max-width:500px; box-shadow:0 0 8px rgba(0,0,0,0.1); }
.group h2 { margin:0 0 10px; color:#007BFF; border-bottom:2px solid #007BFF; padding-bottom:4px; }
.item { border-bottom:1px dashed #ccc; padding:6px 0; cursor:pointer; }
.item:last-child { border-bottom:none; }
.name { font-weight:bold; color:#222; }
.headline { color:#555; }
.link a { color:#007BFF; text-decoration:none; }
.link a:hover { text-decoration:underline; }
.refreshNote { text-align:center; color:#777; font-size:14px; margin-top:10px; }
.selected { border:2px solid #4CAF50; box-shadow:0 0 10px #4CAF50; }
#mainPlayBtn { position:fixed; bottom:20px; right:20px; background:#4CAF50; color:white; border:none; border-radius:50%; width:60px; height:60px; display:flex; align-items:center; justify-content:center; font-size:24px; box-shadow:0 4px 8px rgba(0,0,0,0.3); cursor:pointer; }
.headline-link {
  text-decoration: none;
  color: #007BFF;
  font-weight: bold;
}
.headline-link:hover { text-decoration: underline; }
</style>
</head>
<body>
<h1>üìÑ Live Google Sheet (Date-wise Grouped)</h1>
<div id="dataContainer">Loading...</div>
<p class="refreshNote">Auto-refreshes every 15 seconds</p>

<!-- Floating Play Button -->
<button id="mainPlayBtn" title="Play Selected">‚ñ∂Ô∏è</button>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/1DtRlkaP23ihYmN8mn4Gx7deLicpVhDY6AiY-bN5pqt8/gviz/tq?tqx=out:json";

let selectedCard = null;

async function fetchSheet() {
  try {
    const res = await fetch(sheetURL);
    const text = await res.text();
    const json = JSON.parse(text.substr(47).slice(0, -2));
    const rows = json.table.rows;

    const data = rows.map(r => ({
      date: r.c[0]?.v || "",
      name: r.c[1]?.v || "",
      msg: r.c[2]?.v || ""
    }));

    const grouped = {};
    data.forEach(item => {
      if (!grouped[item.date]) grouped[item.date] = [];
      grouped[item.date].push(item);
    });

    const container = document.getElementById("dataContainer");
    container.innerHTML = "";

    Object.keys(grouped).forEach(date => {
      const groupDiv = document.createElement("div");
      groupDiv.className = "group";

      let itemsHTML = "";
      grouped[date].forEach(d => {
        const rawLink = d.msg;
        const clickableLink = rawLink.replace(
          /(https?:\/\/[^\s]+)/g,
          '<a href="$1" target="_blank">$1</a>'
        );

        itemsHTML += `
  <div class="item card">
    <a href="${d.msg}" target="_blank" class="headline-link">
      <div class="name">${d.name}</div>
    </a>
    <div class="headline" style="display:none;">${d.msg}</div> <!-- hidden for speech -->
  </div>
`;
      });

      groupDiv.innerHTML = `<h2>${date}</h2>${itemsHTML}`;
      container.appendChild(groupDiv);
    });
/*
    // Attach click listeners after DOM update
    document.querySelectorAll(".card").forEach(card => {
      card.addEventListener("click", ()=>{
        document.querySelectorAll(".card").forEach(c => c.classList.remove("selected"));
        card.classList.add("selected");
        selectedCard = card;
      });
    });
    */
    /*
// Prevent single click opening
document.querySelectorAll(".headline-link").forEach(link=>{
  link.addEventListener("click", e=>{
    e.preventDefault(); // single click me open nahi hoga
  });
  
  // Double click pe open
  link.addEventListener("dblclick", e=>{
    window.open(link.href, "_blank");
  });
});
  */  
    // Card selection
document.querySelectorAll(".card").forEach(card => {
  card.addEventListener("click", ()=>{
    document.querySelectorAll(".card").forEach(c => c.classList.remove("selected"));
    card.classList.add("selected");
    selectedCard = card;
  });
});

// Heading link: single click select card, double-click open link
document.querySelectorAll(".headline-link").forEach(link=>{
  link.addEventListener("click", e=>{
    e.preventDefault();       // page open na ho
    e.stopPropagation();      // click parent par bubble na ho
    
    // Card select kar do
    const card = link.closest(".card");
    if(card){
      document.querySelectorAll(".card").forEach(c => c.classList.remove("selected"));
      card.classList.add("selected");
      selectedCard = card;
    }
  });

  // Double click ‚Üí open link
  link.addEventListener("dblclick", e=>{
    window.open(link.href, "_blank");
  });
});
  } catch (err) {
    console.error("Error fetching sheet:", err);
  }
}
/*
// Floating Play Button
document.getElementById("mainPlayBtn").addEventListener("click", ()=>{
  if(!selectedCard){
    alert("Please select a card first!");
    return;
  }
  const textToRead = selectedCard.querySelector(".headline").innerText;
  const speech = new SpeechSynthesisUtterance(textToRead);
  speech.lang = "hi-IN";
  window.speechSynthesis.speak(textToRead);
});
*/
  /*
  document.getElementById("mainPlayBtn").addEventListener("click", ()=>{
  if(!selectedCard){
    alert("Please select a card first!");
    return;
  }

  const textToRead = selectedCard.querySelector(".headline")?.innerText.trim();
  if(!textToRead){
    alert("No text found in this card!");
    return;
  }

  // Stop any ongoing speech
  if(window.speechSynthesis.speaking){
    window.speechSynthesis.cancel();
  }

  const utter = new SpeechSynthesisUtterance(textToRead);
  utter.lang = "hi-IN"; // Hindi voice
  utter.rate = 1;       // speed
  utter.pitch = 1;      // pitch
  window.speechSynthesis.speak(utter);
});
  */
  /*
  const mainPlayBtn = document.getElementById("mainPlayBtn");

mainPlayBtn.addEventListener("click", ()=>{
  if(!selectedCard){
    alert("Please select a card first!");
    return;
  }

  // Agar speech chal rahi hai ‚Üí stop kar do
  if(window.speechSynthesis.speaking){
    window.speechSynthesis.cancel();
    mainPlayBtn.innerText = "‚ñ∂Ô∏è"; // icon back to play
    return;
  }

  // Naya speech play karna
  const textToRead = selectedCard.querySelector(".name")?.innerText.trim();
  if(!textToRead) return;

  const utter = new SpeechSynthesisUtterance(textToRead);
  utter.lang = "hi-IN";

  // Speech khatam hone par button icon wapas play me
  utter.onend = () => {
    mainPlayBtn.innerText = "‚ñ∂Ô∏è";
  }

  window.speechSynthesis.speak(utter);
  mainPlayBtn.innerText = "‚èπÔ∏è"; // icon to stop
});
  */
  /*
  const mainPlayBtn = document.getElementById("mainPlayBtn");

mainPlayBtn.addEventListener("click", ()=>{
  if(!selectedCard){
    alert("Please select a card first!");
    return;
  }

  const textToRead = selectedCard.querySelector(".name").innerText.trim();
  if(!textToRead){
    alert("Nothing to read!");
    return;
  }

  if(window.speechSynthesis.speaking){
    window.speechSynthesis.cancel();
    mainPlayBtn.innerText = "‚ñ∂Ô∏è";
    return;
  }

  const utter = new SpeechSynthesisUtterance(textToRead);
  utter.lang = "hi-IN";
  utter.onend = () => { mainPlayBtn.innerText = "‚ñ∂Ô∏è"; }

  window.speechSynthesis.speak(utter);
  mainPlayBtn.innerText = "‚èπÔ∏è";
});
  */
  /*
    const mainPlayBtn = document.getElementById("mainPlayBtn");

mainPlayBtn.addEventListener("click", ()=>{
  if(!selectedCard){
    alert("Please select a card first!");
    return;
  }

  // Stop any ongoing speech
  if(window.speechSynthesis.speaking){
    window.speechSynthesis.cancel();
    mainPlayBtn.innerText = "‚ñ∂Ô∏è";
    return;
  }

  // Get all text inside selected card
  const lines = selectedCard.querySelectorAll(".name");
  const texts = Array.from(lines).map(l => l.innerText.trim()).filter(t => t);

  if(texts.length === 0){
    alert("Nothing to read!");
    return;
  }

  mainPlayBtn.innerText = "‚èπÔ∏è";

  // Function to read lines sequentially
  let i = 0;
  const speakNext = () => {
    if(i >= texts.length){
      mainPlayBtn.innerText = "‚ñ∂Ô∏è";
      return;
    }
    const utter = new SpeechSynthesisUtterance(texts[i]);
    utter.lang = "hi-IN";
    utter.onend = () => {
      i++;
      speakNext();
    };
    window.speechSynthesis.speak(utter);
  }

  speakNext(); // start reading
});
  */
    const mainPlayBtn = document.getElementById("mainPlayBtn");
let selectedGroup = null; // aap fetchSheet ke baad ya group click pe set karoge

// Card / group click pe selection
function attachGroupSelection(){
  document.querySelectorAll(".group").forEach(group=>{
    group.addEventListener("click", ()=>{
      document.querySelectorAll(".group").forEach(g=>g.classList.remove("selected"));
      group.classList.add("selected");
      selectedGroup = group;
    });
  });
}

// Floating Play / Stop
mainPlayBtn.addEventListener("click", ()=>{
  if(!selectedGroup){
    alert("Please select a group first!");
    return;
  }

  // Stop ongoing speech
  if(window.speechSynthesis.speaking){
    window.speechSynthesis.cancel();
    mainPlayBtn.innerText = "‚ñ∂Ô∏è";
    return;
  }

  // Get all lines inside selected group
  const lines = selectedGroup.querySelectorAll(".name");
  const texts = Array.from(lines).map(l => l.innerText.trim()).filter(t => t);
  if(texts.length === 0){
    alert("Nothing to read!");
    return;
  }

  let i = 0;
  mainPlayBtn.innerText = "‚èπÔ∏è"; // show stop icon

  const speakNext = () => {
    if(i >= texts.length){
      mainPlayBtn.innerText = "‚ñ∂Ô∏è"; // back to play icon when done
      return;
    }
    const utter = new SpeechSynthesisUtterance(texts[i]);
    utter.lang = "hi-IN";
    utter.onend = () => {
      i++;
      speakNext();
    }
    window.speechSynthesis.speak(utter);
  }

  speakNext();
});
// First load
fetchSheet();
// Auto-refresh every 15 sec
setInterval(fetchSheet, 15000);
</script>
</body>
</html>
